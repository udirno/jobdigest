---
phase: 01-foundation-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/onboarding.html
  - src/onboarding.js
  - src/onboarding.css
  - src/popup.js
  - src/settings.js
  - src/popup.html
  - manifest.json
autonomous: true

must_haves:
  truths:
    - "First-time user sees onboarding flow that guides through API key setup"
    - "User can enter Claude, Adzuna, and JSearch API keys"
    - "User can test each API connection individually with Test Connection button"
    - "Validation shows green check on success and red X on failure"
    - "User can save keys and complete onboarding even with invalid keys"
    - "Returning user sees settings where they can update API keys"
  artifacts:
    - path: "src/onboarding.html"
      provides: "Onboarding wizard page for first-time API key setup"
      min_lines: 40
    - path: "src/onboarding.js"
      provides: "Onboarding logic: multi-step wizard, API key input, test connection, save"
      min_lines: 100
    - path: "src/onboarding.css"
      provides: "Onboarding styles matching design system"
      min_lines: 50
    - path: "src/popup.js"
      provides: "Popup entry point that routes to onboarding or main view"
      min_lines: 30
    - path: "src/settings.js"
      provides: "Settings panel for updating API keys post-onboarding"
      min_lines: 60
  key_links:
    - from: "src/popup.js"
      to: "src/onboarding.html"
      via: "redirect if onboarding not completed"
      pattern: "onboarding\\.completed|onboarding\\.html"
    - from: "src/onboarding.js"
      to: "chrome.runtime.sendMessage"
      via: "TEST_API_CONNECTION message to background"
      pattern: "sendMessage.*TEST_API_CONNECTION"
    - from: "src/onboarding.js"
      to: "src/storage.js"
      via: "saves API keys to storage"
      pattern: "storage\\.setApiKeys|storage\\.set"
    - from: "src/settings.js"
      to: "src/storage.js"
      via: "reads and updates API keys"
      pattern: "storage\\.getApiKeys|storage\\.setApiKeys"
---

<objective>
Build the onboarding flow for first-time API key setup and the settings page for updating keys post-onboarding. This is the user's first interaction with the extension.

Purpose: Users cannot use the extension without API keys (CONFIG-01). The onboarding flow must be smooth and non-blocking (save invalid keys per user decision). Test Connection buttons provide confidence before first use.
Output: Complete onboarding wizard and settings page that handle all three API key configurations.
</objective>

<execution_context>
@/Users/udirno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/udirno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build onboarding wizard with API key configuration</name>
  <files>
    src/onboarding.html
    src/onboarding.js
    src/onboarding.css
    manifest.json
  </files>
  <action>
Create a multi-step onboarding wizard (Claude's discretion: using a 3-step wizard approach) that guides users through API key setup on first install (CONFIG-01).

**manifest.json update:**
Add onboarding.html to `web_accessible_resources` if needed for navigation. No other manifest changes needed since onboarding opens as a new tab.

**src/onboarding.html:**
Full HTML page (not popup-sized, full browser tab) with:
- Link to onboarding.css
- Script tag `type="module"` pointing to onboarding.js
- Container div with wizard structure:
  - Step indicator (Step 1 of 3, Step 2 of 3, Step 3 of 3) with visual progress dots
  - Step 1: Claude API Key
    - Brief explanation: "JobDigest uses Claude to score jobs against your resume"
    - Input field for API key (type="password" with show/hide toggle)
    - "Test Connection" button next to input
    - Status indicator area (green check / red X / spinner)
    - Link: "Get your API key at console.anthropic.com"
  - Step 2: Adzuna API Key
    - Brief explanation: "Adzuna provides job listings from thousands of sources"
    - Two input fields: App ID and App Key (both type="password" with show/hide toggle)
    - "Test Connection" button
    - Status indicator area
    - Link: "Get your API key at developer.adzuna.com"
  - Step 3: JSearch API Key
    - Brief explanation: "JSearch provides additional job listings via RapidAPI"
    - Input field for API key (type="password" with show/hide toggle)
    - "Test Connection" button
    - Status indicator area
    - Link: "Get your API key at rapidapi.com/letscrape-6bRBa3QguO5/api/jsearch"
  - Navigation: "Back" button (disabled on step 1), "Continue"/"Finish" button
  - "Skip for now" link at bottom of each step (saves empty key, moves to next step)

**src/onboarding.js:**
- On load: Check if onboarding already completed via `chrome.runtime.sendMessage({ type: 'GET_ONBOARDING_STATUS' })`. If completed, redirect to close tab or show "Already set up" message.
- Step navigation: Track current step (1-3), show/hide step containers, update progress indicator
- Show/hide toggle for password inputs: Toggle input type between "password" and "text"
- "Test Connection" button handler:
  - Show spinner (CSS animation, no external assets)
  - Send `chrome.runtime.sendMessage({ type: 'TEST_API_CONNECTION', service: 'claude'|'adzuna'|'jsearch', credentials: {...} })`
  - On success: Show green checkmark icon (use Unicode or CSS-drawn)
  - On failure: Show red X with the error message text below
  - Per user decision: simple success/failure only (green check or red X), no quota/account details
- "Continue" button handler:
  - Save current step's API key(s) to storage via `chrome.runtime.sendMessage` or direct storage import
  - Per user decision: save the key regardless of validation status (don't block onboarding)
  - Move to next step (or finish if step 3)
- "Finish" button (on step 3):
  - Save final API key
  - Mark onboarding as completed: `storage.setOnboarding({ completed: true, completedAt: new Date().toISOString() })`
  - Show brief success message: "You're all set! Click the JobDigest icon in your toolbar to get started."
  - Close tab after 2 seconds or on click
- "Skip for now" link: Saves empty string for that key, moves to next step
- Validation triggers on Save/Continue click only (NOT on paste) -- per user decision

**src/onboarding.css:**
- Use same CSS variables from popup.css (--bg-primary, --accent, etc.) -- redefine them here since this is a separate HTML page
- Full-page centered layout (max-width: 600px, centered vertically and horizontally)
- Step indicator: horizontal dots showing progress (filled for completed, outlined for current/future)
- Input fields: dark background (#2a2a2a), light border, focus state with accent color border
- Buttons: accent color background (#c9a96e) with dark text, hover state slightly lighter
- "Skip for now" link: subtle, text-secondary color, underline on hover
- Status indicators: green (#27ae60) checkmark, red (#e74c3c) X mark, spinner animation
- Responsive: works on any screen size (it's a full tab page)
  </action>
  <verify>
1. Load extension in Chrome
2. Navigate to the onboarding page: `chrome-extension://{extension-id}/src/onboarding.html`
   (Find extension ID on chrome://extensions page)
3. Verify 3-step wizard renders with Claude API key as step 1
4. Type a fake key, click "Test Connection" -- should show red X (invalid key)
5. Click "Continue" -- should move to step 2 (key saved despite being invalid, per user decision)
6. Click "Skip for now" on step 2 -- should move to step 3 with empty key
7. Click "Finish" on step 3 -- should mark onboarding complete
8. Check storage: `chrome.storage.local.get(null, r => console.log(r))` in service worker console -- apiKeys and onboarding should be populated
  </verify>
  <done>
3-step onboarding wizard renders in full browser tab. Each step shows API name, explanation, masked input with show/hide toggle, Test Connection button, and status indicator (green check/red X). Continue saves keys regardless of validation status. Skip for now saves empty key. Finish marks onboarding complete. All per user decisions from CONTEXT.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build popup routing and settings page</name>
  <files>
    src/popup.js
    src/popup.html
    src/settings.js
  </files>
  <action>
Create the popup entry point that routes users to onboarding (if first time) or shows the main view with settings access, and build the settings page for updating API keys post-onboarding.

**src/popup.html update:**
Expand the existing stub to include:
- Navigation area at top: "JobDigest" title + gear icon button for settings
- Main content area: `<div id="main-view">` (placeholder for future dashboard content -- show "No jobs yet. Jobs will appear here after your first fetch." message for now)
- Settings panel: `<div id="settings-panel" class="hidden">` containing the settings form
- The settings panel slides in/overlays the main view (toggled by gear icon)

**src/popup.js:**
- On DOMContentLoaded:
  1. Check onboarding status: `chrome.runtime.sendMessage({ type: 'GET_ONBOARDING_STATUS' })`
  2. If NOT completed: Open onboarding in new tab (`chrome.tabs.create({ url: chrome.runtime.getURL('src/onboarding.html') })`) and close popup (`window.close()`)
  3. If completed: Show main view, initialize settings panel
- Gear icon click: Toggle settings panel visibility
- Import and initialize settings module

**src/settings.js:**
Settings module for viewing and updating API keys (CONFIG-02, CONFIG-03, CONFIG-04):

`initSettings(container)`:
- Renders API key settings form inside the provided container element
- For each API (Claude, Adzuna, JSearch):
  - Label with API name
  - Input field (type="password") pre-filled with saved key (masked)
  - Show/hide toggle button
  - "Test Connection" button with status indicator (same as onboarding)
  - Individual save happens on blur or explicit "Save" button per section
- Uses same message passing as onboarding: `chrome.runtime.sendMessage({ type: 'TEST_API_CONNECTION', ... })`
- On load: Read API keys from storage, populate inputs (show masked values like "sk-ant-...xxxx" -- last 4 chars visible)
- Save button (per section or global): Save updated keys to storage via `storage.setApiKeys()`
- Per user decision: Validate on Save click only, save regardless of validation result, show green check or red X on test

`loadApiKeys()`:
- Reads from storage, returns key objects
- Masks keys for display (first 8 + ... + last 4 characters)

Export: `initSettings`, `loadApiKeys`.

**Popup CSS additions (in popup.css):**
- Settings panel: slides from right or overlays, same dark theme
- Hidden class: `display: none`
- Gear icon: SVG or Unicode gear (settings cog), positioned top-right
- Consistent input/button styles matching onboarding
  </action>
  <verify>
1. Load extension, click the extension icon in toolbar
2. If onboarding not completed: Should open onboarding tab and close popup
3. Complete onboarding flow first (from Task 1 verification)
4. Click extension icon again: Should show main view with "No jobs yet" placeholder
5. Click gear icon: Settings panel should appear showing all three API key sections
6. Keys should show masked values (e.g., "sk-ant-...xxxx")
7. Click "Test Connection" on any API: Should show spinner then green check or red X
8. Modify a key and save: Verify new value persists (close and reopen popup, check settings)
  </verify>
  <done>
Popup routes to onboarding on first launch (CONFIG-01). After onboarding, popup shows main view placeholder with settings gear icon. Settings panel shows all three API key configurations (CONFIG-02, CONFIG-03, CONFIG-04) with masked display, show/hide toggle, Test Connection with green check/red X feedback, and save. All interactions use message passing to background service worker.
  </done>
</task>

</tasks>

<verification>
1. Fresh install (clear extension data): Clicking extension icon opens onboarding in new tab
2. Complete all 3 onboarding steps with test keys
3. After onboarding: Clicking extension icon shows popup with main view
4. Settings gear icon toggles settings panel
5. Settings shows all three API key fields with masked values
6. Test Connection buttons work for all three APIs (red X for invalid keys is expected)
7. Saving updated keys persists across popup close/reopen
</verification>

<success_criteria>
- First-time user is guided through 3-step onboarding wizard (CONFIG-01)
- User can configure Claude API key (CONFIG-02)
- User can configure Adzuna API key (CONFIG-03)
- User can configure JSearch API key (CONFIG-04)
- Each API has individual Test Connection button showing green check or red X
- Keys are saved even when validation fails (per user decision)
- Validation only triggers on Save/Continue click (per user decision)
- Returning user sees settings page to update keys
- Settings shows masked key values with show/hide toggle
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-03-SUMMARY.md`
</output>
