---
phase: 01-foundation-infrastructure
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Extension installs and runs on Chrome with Manifest V3"
    - "User completes onboarding flow and configures all three API keys"
    - "Service worker persists state to chrome.storage.local and restores on restart"
    - "API calls handle failures gracefully with user-friendly error messages"
    - "Extension requests and uses unlimitedStorage permission"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Phase 1 foundation works end-to-end: extension installs, onboarding flow completes, service worker lifecycle is resilient, and error handling works correctly.

Purpose: This is the integration verification before moving to Phase 2. All five phase success criteria must be confirmed working together.
Output: Verified working extension ready for resume management (Phase 2) and job fetching (Phase 3) features.
</objective>

<execution_context>
@/Users/udirno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/udirno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-02-SUMMARY.md
@.planning/phases/01-foundation-infrastructure/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run automated integration checks</name>
  <files></files>
  <action>
Run a series of automated checks to verify Phase 1 integration before human verification.

**Check 1: Manifest validation**
```bash
node -e "
const m = JSON.parse(require('fs').readFileSync('manifest.json','utf8'));
const checks = [
  ['manifest_version', m.manifest_version === 3],
  ['permissions.storage', m.permissions.includes('storage')],
  ['permissions.unlimitedStorage', m.permissions.includes('unlimitedStorage')],
  ['permissions.alarms', m.permissions.includes('alarms')],
  ['host_permissions.anthropic', m.host_permissions.some(h => h.includes('anthropic'))],
  ['host_permissions.adzuna', m.host_permissions.some(h => h.includes('adzuna'))],
  ['host_permissions.jsearch', m.host_permissions.some(h => h.includes('jsearch'))],
  ['service_worker', m.background && m.background.service_worker === 'src/background.js'],
  ['module_type', m.background && m.background.type === 'module'],
  ['popup', m.action && m.action.default_popup === 'src/popup.html'],
];
checks.forEach(([name, ok]) => console.log(ok ? 'PASS' : 'FAIL', name));
const allPass = checks.every(([,ok]) => ok);
process.exit(allPass ? 0 : 1);
"
```

**Check 2: File existence**
Verify all required files exist:
- manifest.json
- src/background.js
- src/storage.js
- src/errors.js
- src/keep-alive.js
- src/popup.html
- src/popup.js
- src/popup.css
- src/onboarding.html
- src/onboarding.js
- src/onboarding.css
- icons/icon16.png
- icons/icon48.png
- icons/icon128.png

**Check 3: Module imports**
Verify that background.js imports from storage.js, errors.js, and keep-alive.js (grep for import statements).

**Check 4: Storage key coverage**
Verify storage.js exports STORAGE_KEYS with all expected keys (apiKeys, settings, resume, jobs, dailyStats, onboarding, batchProgress).

**Check 5: Error handling exports**
Verify errors.js exports ApiError, retryWithBackoff, getUserMessage, createApiError.

Report results as a checklist. If any check fails, note what needs fixing.
  </action>
  <verify>All automated checks pass (exit code 0 for the node script, all files exist, all imports present).</verify>
  <done>All automated integration checks pass: manifest valid, all files exist, imports wired correctly, storage keys complete, error exports present.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete onboarding flow</name>
  <what-built>
Complete Phase 1 foundation: Chrome Extension with Manifest V3 scaffolding, storage abstraction, error handling with exponential backoff, service worker lifecycle management with keep-alive, onboarding wizard for API key setup, and settings page.
  </what-built>
  <how-to-verify>
**Setup:**
1. Go to `chrome://extensions`
2. Enable "Developer mode" (toggle in top right)
3. Click "Load unpacked" and select the project folder
4. Extension should appear without red error badges

**Test 1: First-time onboarding (CONFIG-01)**
1. Click the JobDigest extension icon in the toolbar
2. A new tab should open with the onboarding wizard
3. Verify Step 1 shows Claude API key input with explanation text
4. Enter any text as a fake key
5. Click "Test Connection" -- should show red X (invalid key)
6. Click "Continue" -- should save key and move to Step 2 (even though test failed, per user decision)
7. Click "Skip for now" on Step 2 -- should move to Step 3
8. Click "Finish" on Step 3 -- should show success message

**Test 2: Post-onboarding popup**
1. Click the extension icon again
2. Should show popup with "No jobs yet" placeholder and gear icon
3. Should NOT redirect to onboarding again

**Test 3: Settings (CONFIG-02, CONFIG-03, CONFIG-04)**
1. Click the gear icon in popup
2. Settings panel should show all three API key fields
3. Claude key should show masked value from onboarding
4. Adzuna fields should be empty (skipped during onboarding)
5. JSearch field should be empty (skipped during onboarding)

**Test 4: Service worker resilience**
1. Go to `chrome://extensions`
2. Click "Service worker" link under JobDigest
3. In DevTools console, type: `chrome.storage.local.get(null, r => console.log(r))`
4. Verify storage has apiKeys, onboarding (completed: true), dailyStats
5. Click "Terminate" on the service worker
6. Click extension icon -- popup should work normally (service worker restarts)

**Test 5: Verify permissions**
1. In DevTools console (service worker): `chrome.storage.local.getBytesInUse(null, b => console.log('Storage used:', b, 'bytes'))`
2. Should return a number (confirms unlimitedStorage is active)
  </how-to-verify>
  <resume-signal>Type "approved" if all 5 tests pass, or describe specific issues to fix.</resume-signal>
</task>

</tasks>

<verification>
All five phase success criteria verified:
1. Extension installs and runs on Chrome with Manifest V3
2. User completes onboarding flow and configures all three API keys
3. Service worker persists state and restores on restart
4. API calls handle failures with user-friendly error messages (Test Connection shows meaningful errors)
5. Extension requests unlimitedStorage permission
</verification>

<success_criteria>
- All automated checks pass (manifest, files, imports, exports)
- Human confirms: onboarding flow works end-to-end
- Human confirms: settings page shows and updates API keys
- Human confirms: service worker survives termination and restart
- Human confirms: storage persists across sessions
- Phase 1 complete, ready for Phase 2
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-04-SUMMARY.md`
</output>
