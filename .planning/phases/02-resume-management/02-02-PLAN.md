---
phase: 02-resume-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/popup.html
  - src/popup.css
  - src/settings.js
autonomous: false

must_haves:
  truths:
    - "User can upload a PDF resume and see extracted text confirmation"
    - "User can upload a DOCX resume and see extracted text confirmation"
    - "User can paste plain text resume and save it"
    - "Resume text persists in chrome.storage.local and loads on extension restart"
    - "Previously saved resume displays on settings panel open"
  artifacts:
    - path: "src/popup.html"
      provides: "mammoth.js script tag and resume section markup reference"
      contains: "mammoth.browser.min.js"
    - path: "src/settings.js"
      provides: "Resume management UI section with file upload, text paste, and status display"
      contains: "resume-upload"
    - path: "src/popup.css"
      provides: "Styles for resume upload section"
      contains: "resume"
  key_links:
    - from: "src/settings.js"
      to: "src/resume-parser.js"
      via: "ES module import"
      pattern: "import.*resume-parser"
    - from: "src/settings.js"
      to: "src/storage.js"
      via: "storage.getResume/setResume"
      pattern: "storage\\.(getResume|setResume)"
    - from: "src/popup.html"
      to: "src/lib/mammoth.browser.min.js"
      via: "script tag before module scripts"
      pattern: "script.*mammoth"
---

<objective>
Add resume management UI to the settings panel: file upload for PDF/DOCX, textarea for plain text paste, status display showing current resume, and wire everything to the resume-parser.js module from Plan 01. Include human verification of the complete upload flow.

Purpose: This completes the user-facing resume management feature. After this plan, users can upload their resume in any supported format and it persists for use in AI scoring (Phase 4).

Output: Updated settings panel with resume section, popup.html with mammoth.js script tag, CSS styles for resume UI, and verified end-to-end upload flow.
</objective>

<execution_context>
@/Users/udirno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/udirno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-resume-management/02-RESEARCH.md
@.planning/phases/02-resume-management/02-01-SUMMARY.md
@src/popup.html
@src/popup.js
@src/popup.css
@src/settings.js
@src/storage.js
@src/resume-parser.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add resume management UI to settings panel and wire to parser</name>
  <files>src/popup.html, src/popup.css, src/settings.js</files>
  <action>
**Update `src/popup.html`:**

Add mammoth.js script tag BEFORE the module script (mammoth.browser.min.js is a UMD bundle that sets window.mammoth):

```html
<script src="lib/mammoth.browser.min.js"></script>
<script type="module" src="popup.js"></script>
```

The relative path `lib/mammoth.browser.min.js` works because popup.html is in `src/` and lib is at `src/lib/`. Note: do NOT use `src/lib/` prefix since popup.html is already inside `src/`.

**Update `src/settings.js`:**

1. Add import at top: `import { processResumeFile } from './resume-parser.js';`

2. Add a new "Resume" section to the settings HTML (rendered in `initSettings`), placed ABOVE the existing "API Keys" section. The resume section should contain:

   a. **Section header:** "Resume" with description "Upload your resume for AI job matching."

   b. **Current resume status area** (`id="resume-status"`):
      - If resume exists in storage: show "Current: {fileName} (uploaded {relative date})" with a "Remove" button
      - If no resume: show "No resume uploaded"
      - Load this on init by calling `storage.getResume()` and updating the display

   c. **File upload area:**
      - `<input type="file" id="resume-upload" accept=".pdf,.docx" class="file-input">` (visually hidden)
      - A styled upload button/label: `<label for="resume-upload" class="btn-upload">Upload PDF or DOCX</label>`
      - Accepted formats note: `<span class="upload-hint">PDF or DOCX, max 5MB</span>`

   d. **Text paste area:**
      - Divider text: "Or paste resume text:"
      - `<textarea id="resume-text" class="resume-textarea" rows="6" placeholder="Paste your resume content here..."></textarea>`
      - `<button id="save-resume-text" class="btn-primary btn-sm">Save Text</button>`

   e. **Processing/status feedback** (`id="resume-feedback"`):
      - Shows processing state, success, or error messages
      - Uses the same status-indicator pattern from API key testing

3. Add event handlers (in `attachEventListeners` or a new `attachResumeListeners` function):

   a. **File upload handler** on `#resume-upload` change event:
      - Get file from event.target.files[0], return if none
      - Show loading: "Processing {fileName}..."
      - Call `processResumeFile(file)` from resume-parser.js
      - On success: call `storage.setResume(result)` to persist, update resume-status display to show fileName and character count, show success message: "Resume uploaded: {fileName} ({text.length} characters)"
      - On error: show error message from caught error
      - Reset file input value to '' so same file can be re-uploaded

   b. **Text paste save handler** on `#save-resume-text` click:
      - Get text from `#resume-text` textarea, trim it
      - Validate: if length < 50, show error "Resume text too short. Please provide at least 50 characters."
      - Call `storage.setResume({ text, fileName: 'pasted-text.txt', uploadedAt: new Date().toISOString() })`
      - Update resume-status display
      - Show success: "Resume text saved ({text.length} characters)"
      - Clear the textarea

   c. **Remove resume handler** on remove button click:
      - Call `storage.clearResume()`
      - Update resume-status to "No resume uploaded"
      - Show feedback: "Resume removed"

4. Add `loadResumeStatus()` function that reads `storage.getResume()` and updates the resume-status element. Call this in `initSettings` after rendering HTML.

**Update `src/popup.css`:**

Add styles for the resume section. Follow existing design system (--bg-primary, --bg-secondary, --accent, --text-primary, --text-secondary, --error, --success):

1. `.resume-section` - margin-bottom: 24px, padding-bottom: 24px, border-bottom: 1px solid var(--bg-secondary)

2. `.resume-status` - padding: 12px, background: var(--bg-secondary), border-radius: 4px, margin-bottom: 16px, font-size: 13px, color: var(--text-secondary). When resume present, show fileName in --text-primary color.

3. `.resume-status .file-name` - color: var(--text-primary), font-weight: 500

4. `.btn-remove` - small inline button, background: none, border: 1px solid var(--error), color: var(--error), border-radius: 4px, padding: 2px 8px, font-size: 12px, cursor: pointer, margin-left: 8px. Hover: background var(--error), color white.

5. `.file-input` - visually hidden (position: absolute, width: 1px, height: 1px, overflow: hidden, clip: rect(0,0,0,0))

6. `.btn-upload` - styled like btn-test but wider: display: inline-block, padding: 10px 20px, background: transparent, border: 1px solid var(--accent), color: var(--accent), border-radius: 4px, cursor: pointer, font-size: 13px, text-align: center. Hover: background var(--accent), color var(--bg-primary).

7. `.upload-hint` - font-size: 12px, color: var(--text-secondary), margin-left: 12px

8. `.divider-text` - font-size: 13px, color: var(--text-secondary), margin: 16px 0 8px

9. `.resume-textarea` - width: 100%, padding: 10px 12px, background: var(--bg-secondary), border: 1px solid #3a3a3a, border-radius: 4px, color: var(--text-primary), font-size: 13px, font-family: inherit, resize: vertical, min-height: 100px. Focus: border-color var(--accent), outline none.

10. `.btn-sm` - padding: 8px 16px, font-size: 13px, margin-top: 8px

11. `.resume-feedback` - margin-top: 12px, font-size: 13px, min-height: 20px. Reuse .status-indicator success/error/loading patterns already in popup.css.

Keep the hidden class override for settings-panel: The current CSS has `.hidden { display: none; }` which conflicts with the settings panel transform animation. The settings panel `.settings-panel.hidden` uses `transform: translateX(100%)` which requires the element to NOT be `display: none`. Verify this is still working correctly - if the `.hidden` class causes settings to not animate, scope the display:none to only apply outside settings-panel context.
  </action>
  <verify>
- `grep "mammoth.browser.min.js" src/popup.html` confirms script tag added
- `grep "resume-upload" src/settings.js` confirms file input element
- `grep "processResumeFile" src/settings.js` confirms parser import and usage
- `grep "storage.getResume\|storage.setResume\|storage.clearResume" src/settings.js` confirms storage wiring
- `grep "resume-textarea\|btn-upload\|resume-status\|file-input" src/popup.css` confirms new styles
- `grep "resume-text\|save-resume-text" src/settings.js` confirms text paste handler
- Open extension popup in Chrome, click Settings - resume section should appear above API Keys
  </verify>
  <done>
Settings panel shows resume management section with: file upload button (PDF/DOCX), text paste textarea with save button, current resume status display, remove button when resume exists. File upload triggers processResumeFile and persists result. Text paste validates 50+ chars and persists. Previously saved resume loads and displays on settings open.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete resume management feature: file upload (PDF/DOCX), text paste, storage persistence, and UI in settings panel.</what-built>
  <how-to-verify>
1. Load extension in Chrome (chrome://extensions, reload if needed)
2. Click extension icon to open popup
3. Click Settings gear icon - verify "Resume" section appears above "API Keys"
4. **Test PDF upload:**
   - Click "Upload PDF or DOCX" button
   - Select a PDF resume file
   - Verify success message shows filename and character count
   - Verify "Current: {filename}" appears in status area
5. **Test DOCX upload:**
   - Click "Upload PDF or DOCX" again
   - Select a DOCX resume file
   - Verify it replaces previous resume and shows new filename
6. **Test text paste:**
   - Click "Remove" to clear current resume
   - Paste resume text (50+ characters) into textarea
   - Click "Save Text"
   - Verify success message and status shows "pasted-text.txt"
7. **Test persistence:**
   - Close popup
   - Reopen popup and go to Settings
   - Verify previously saved resume still shows in status
8. **Test validation:**
   - Try uploading a .txt or .jpg file - should show error
   - Try saving text with < 50 characters - should show error
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Resume section visible in settings panel above API Keys section
2. File upload accepts PDF and DOCX, rejects other formats
3. Text paste works with 50+ character minimum validation
4. Extracted text persists in chrome.storage.local under 'resume' key
5. Resume status loads from storage when settings panel opens
6. Remove button clears resume from storage and UI
7. Error messages display for invalid files, corrupt files, and short text
</verification>

<success_criteria>
- RESUME-01: User can upload PDF resume and extension extracts text successfully
- RESUME-02: User can upload DOCX resume and extension extracts text successfully
- RESUME-03: User can paste plain text resume directly
- RESUME-04: Extension parses and stores resume text in chrome.storage.local
- Resume persists across popup close/reopen (storage persistence verified)
- File validation enforces 5MB limit and PDF/DOCX only
- UI follows existing design system (dark theme, sand brown accents)
</success_criteria>

<output>
After completion, create `.planning/phases/02-resume-management/02-02-SUMMARY.md`
</output>
