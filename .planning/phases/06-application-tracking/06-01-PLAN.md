---
phase: 06-application-tracking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/storage.js
  - src/dashboard/filters.js
  - src/dashboard/job-card.js
  - src/popup.html
  - src/popup.css
autonomous: true

must_haves:
  truths:
    - "Dismissed jobs do not appear in the main dashboard view by default"
    - "Jobs with status Passed do not appear in main dashboard view by default"
    - "User can toggle Show hidden jobs checkbox to reveal dismissed jobs"
    - "User can see a note icon on cards that have notes"
    - "Dismiss button on card hides the job and shows undo toast"
  artifacts:
    - path: "src/storage.js"
      provides: "Job data model with notes, applicationDate, dismissed fields"
      contains: "updateJob"
    - path: "src/dashboard/filters.js"
      provides: "Filtering logic excluding dismissed and passed jobs"
      contains: "includeDismissed"
    - path: "src/dashboard/job-card.js"
      provides: "Job cards with dismiss button and note indicator"
      contains: "btn-dismiss"
    - path: "src/popup.css"
      provides: "Toast notification styles and dismiss button styles"
      contains: "toast"
  key_links:
    - from: "src/dashboard/job-card.js"
      to: "src/storage.js"
      via: "storage.updateJob for dismiss action"
      pattern: "storage\\.(updateJob|saveJob)"
    - from: "src/dashboard/filters.js"
      to: "src/storage.js"
      via: "getJobs with dismissed/passed filtering"
      pattern: "dismissed|passed"
---

<objective>
Add dismiss functionality, hidden job filtering, and note indicator to job cards. Extend storage with a convenience method for updating individual job fields. Modify the dashboard filter logic to exclude dismissed jobs and Passed-status jobs from the default view, with a "Show hidden jobs" toggle.

Purpose: Enables users to clean up their job dashboard by hiding irrelevant jobs while keeping data recoverable. This is the data/logic foundation that Plan 02 builds on for notes, dates, and modal enhancements.

Output: Working dismiss-with-undo on cards, hidden job filter toggle in toolbar, note icon on cards, and updated filter logic that treats Passed like dismiss.
</objective>

<execution_context>
@/Users/udirno/.claude/get-shit-done/workflows/execute-plan.md
@/Users/udirno/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-application-tracking/06-CONTEXT.md
@.planning/phases/06-application-tracking/06-RESEARCH.md
@src/storage.js
@src/dashboard/filters.js
@src/dashboard/job-card.js
@src/dashboard/empty-state.js
@src/popup.html
@src/popup.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend storage, update filter logic, and add hidden jobs toggle</name>
  <files>src/storage.js, src/dashboard/filters.js, src/popup.html, src/popup.css</files>
  <action>
**storage.js:** Add a convenience method `updateJob(jobId, updates)` that reads the job, merges the updates object, and saves. This avoids callers needing to do read-modify-write manually for field updates like notes, applicationDate, dismissed. Pattern:
```javascript
async updateJob(jobId, updates) {
  const jobs = await this.getJobs();
  if (!jobs[jobId]) return;
  Object.assign(jobs[jobId], updates);
  await this.set(STORAGE_KEYS.JOBS, jobs);
  return jobs[jobId];
}
```

**filters.js:** Modify `getFilteredAndSortedJobs()`:
1. Add a module-level `let showHidden = false;` state variable.
2. After converting jobsMap to array, filter out jobs where `job.dismissed === true` UNLESS `showHidden` is true.
3. When `currentFilter` is `all`, also filter out jobs where `job.status === 'passed'` UNLESS `showHidden` is true. This makes "Passed" behave like dismiss per user decision (auto-hides from main view but accessible via filter or show-hidden toggle).
4. When `currentFilter === 'passed'`, show passed jobs normally (user explicitly filtering for them).
5. Export a `setShowHidden(value)` function that updates the state and calls `renderJobGrid()`.
6. Export `getShowHidden()` for other modules.

**popup.html:** Add a "Show hidden jobs" checkbox in the toolbar-left area, after the job-count span:
```html
<label class="filter-toggle" title="Include dismissed and passed jobs">
  <input type="checkbox" id="show-hidden" />
  <span class="toggle-label">Show hidden</span>
</label>
```

**popup.css:** Add styles for the filter toggle:
```css
.filter-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: var(--text-secondary);
  cursor: pointer;
}
.filter-toggle input[type="checkbox"] {
  cursor: pointer;
  accent-color: var(--accent);
}
.toggle-label {
  white-space: nowrap;
}
```

**filters.js (initDashboardControls):** Add event listener for `#show-hidden` checkbox that calls `setShowHidden(e.target.checked)`.
  </action>
  <verify>
Load extension in Chrome. Verify:
1. Default view does not show any jobs with status "passed" (if any exist).
2. Checking "Show hidden" checkbox reveals passed jobs in the grid.
3. The filter dropdown "Passed" option still works to show only passed jobs.
4. `storage.updateJob` is available and callable from console: `(await import('./storage.js')).storage.updateJob`.
  </verify>
  <done>
Dismissed and passed jobs are hidden from default view. "Show hidden" toggle reveals them. storage.updateJob convenience method exists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add dismiss button to cards with undo toast</name>
  <files>src/dashboard/job-card.js, src/popup.css, src/dashboard/filters.js</files>
  <action>
**job-card.js:** Add a dismiss button in the card footer, between "View Details" and "View Original":
```html
<button class="btn-card-action btn-dismiss" data-job-id="${job.jobId}" title="Hide this job" aria-label="Dismiss job">
  &times;
</button>
```

Add click handler on the dismiss button that:
1. Calls `e.stopPropagation()` to prevent card click.
2. Imports and calls a `dismissJob(jobId)` function.

**job-card.js:** Create `dismissJob(jobId)` function:
1. Call `storage.updateJob(jobId, { dismissed: true })`.
2. Call `renderJobGrid()` (import from filters.js) to remove card from view.
3. Call `showUndoToast('Job hidden', async () => { await storage.updateJob(jobId, { dismissed: false }); await renderJobGrid(); })`.

**job-card.js:** Create `showUndoToast(message, undoCallback)` function:
1. Create a div with class `toast`, `role="status"`, `aria-live="polite"`, `aria-atomic="true"`.
2. innerHTML: `<span>${message}</span><button class="toast-undo">Undo</button>`
3. Append to document.body.
4. Focus the undo button for keyboard accessibility.
5. Add click handler on undo button that calls undoCallback, then removes toast.
6. Set 5-second auto-dismiss timeout. Pause timer on focusin, restart on focusout.
7. Add CSS class `toast-enter` after 10ms for slide-in animation.

Also add a **note indicator** to the card. In card-footer, before "View Details", add:
```html
${job.notes ? '<span class="note-indicator" title="Has notes">&#9998;</span>' : ''}
```
The note indicator is a pencil character (&#9998;) that only shows when the job has notes.

Do NOT show dismissed jobs' cards (the filter handles this, but avoid rendering cards for dismissed jobs as a safety measure by checking `job.dismissed` is not needed since filters.js already excludes them).

**popup.css:** Add toast styles:
```css
.toast {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: #333;
  color: var(--text-primary);
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 200;
  opacity: 0;
  transition: opacity 0.2s, transform 0.2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
.toast.toast-enter {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}
.toast-undo {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  padding: 2px 4px;
}
.toast-undo:hover {
  text-decoration: underline;
}
.toast-undo:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: 2px;
}
```

Add dismiss button and note indicator styles:
```css
.btn-dismiss {
  margin-left: auto;
  font-size: 14px;
  line-height: 1;
  color: var(--text-secondary);
}
.btn-dismiss:hover {
  color: var(--error);
}
.note-indicator {
  font-size: 12px;
  color: var(--text-secondary);
  cursor: default;
}
```
  </action>
  <verify>
Load extension in Chrome. Verify:
1. Each job card has a dismiss button (x icon) in the footer.
2. Clicking dismiss hides the card from view and shows a toast "Job hidden" with "Undo" button.
3. Clicking "Undo" within 5 seconds restores the job card to view.
4. Toast auto-disappears after 5 seconds if not interacted with.
5. If a job has notes field set (manually via console: set a job's notes in storage), a pencil icon appears in the card footer.
6. Dismiss button click does NOT open the job modal.
  </verify>
  <done>
Dismiss button on every card hides the job with reversible undo toast. Note indicator icon appears on cards with notes. Toast is accessible with ARIA attributes and keyboard-focusable undo button.
  </done>
</task>

</tasks>

<verification>
1. Default dashboard view excludes dismissed jobs and Passed-status jobs.
2. "Show hidden" checkbox reveals dismissed and passed jobs.
3. Passed filter in dropdown still works independently.
4. Dismiss button on cards works with undo toast.
5. Note indicator appears only on cards that have notes.
6. storage.updateJob convenience method works correctly.
</verification>

<success_criteria>
- Dismissed jobs hidden from default view with undo recovery
- Passed-status jobs auto-hidden from default view (accessible via filter or Show hidden)
- "Show hidden" toggle in toolbar reveals all hidden jobs
- Note indicator on cards with existing notes
- Toast notifications accessible and auto-dismissing
</success_criteria>

<output>
After completion, create `.planning/phases/06-application-tracking/06-01-SUMMARY.md`
</output>
